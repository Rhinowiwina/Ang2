"use strict";
var date_picker_directive_service_1 = require("./date-picker-directive.service");
var date_picker_component_1 = require("./date-picker.component");
var core_1 = require("@angular/core");
var forms_1 = require("@angular/forms");
var DatePickerDirective = (function () {
    function DatePickerDirective(viewContainerRef, componentFactoryResolver, formControl, service) {
        this.viewContainerRef = viewContainerRef;
        this.componentFactoryResolver = componentFactoryResolver;
        this.formControl = formControl;
        this.service = service;
        this._type = 'day';
    }
    Object.defineProperty(DatePickerDirective.prototype, "config", {
        get: function () {
            return this._config;
        },
        set: function (config) {
            this._config = this.service.getConfig(config, this.viewContainerRef.element, this.attachTo);
            this.updateDatepickerConfig();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatePickerDirective.prototype, "attachTo", {
        get: function () {
            return this._attachTo;
        },
        set: function (attachTo) {
            this._attachTo = attachTo;
            this._config = this.service.getConfig(this.config, this.viewContainerRef.element, this.attachTo);
            this.updateDatepickerConfig();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatePickerDirective.prototype, "theme", {
        get: function () {
            return this._theme;
        },
        set: function (theme) {
            this._theme = theme;
            if (this.datePicker) {
                this.datePicker.theme = theme;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatePickerDirective.prototype, "type", {
        get: function () {
            return this._type;
        },
        set: function (type) {
            this._type = type;
            if (this.datePicker) {
                this.datePicker.type = type;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatePickerDirective.prototype, "minDate", {
        get: function () {
            return this._minDate;
        },
        set: function (minDate) {
            this._minDate = minDate;
            if (this.datePicker) {
                this.datePicker.minDate = minDate;
                this.datePicker.ngOnInit();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatePickerDirective.prototype, "maxDate", {
        get: function () {
            return this._maxDate;
        },
        set: function (maxDate) {
            this._maxDate = maxDate;
            if (this.datePicker) {
                this.datePicker.maxDate = maxDate;
                this.datePicker.ngOnInit();
            }
        },
        enumerable: true,
        configurable: true
    });
    DatePickerDirective.prototype.ngOnInit = function () {
        this.datePicker = this.createDatePicker();
        this.api = this.datePicker.api;
        this.updateDatepickerConfig();
        this.attachModelToDatePicker();
        this.datePicker.theme = this.theme;
    };
    DatePickerDirective.prototype.createDatePicker = function () {
        var factory = this.componentFactoryResolver.resolveComponentFactory(date_picker_component_1.DatePickerComponent);
        return this.viewContainerRef.createComponent(factory).instance;
    };
    DatePickerDirective.prototype.attachModelToDatePicker = function () {
        var _this = this;
        if (!this.formControl) {
            return;
        }
        this.datePicker.onViewDateChange(this.formControl.value);
        this.formControl.valueChanges.subscribe(function (value) {
            if (value !== _this.datePicker.inputElementValue) {
                _this.datePicker.onViewDateChange(value);
            }
        });
        this.datePicker.registerOnChange(function (value) {
            _this.formControl.control.setValue(_this.datePicker.inputElementValue);
            var errors = _this.datePicker.validateFn(value);
            if (errors) {
                _this.formControl.control.setErrors(errors);
            }
            _this.formControl.control.markAsDirty();
        });
    };
    DatePickerDirective.prototype.onClick = function () {
        this.updateDatepickerConfig();
        this.datePicker.onClick();
    };
    DatePickerDirective.prototype.onFocus = function () {
        this.updateDatepickerConfig();
        this.datePicker.inputFocused();
    };
    DatePickerDirective.prototype.updateDatepickerConfig = function () {
        if (this.datePicker) {
            this.datePicker.minDate = this.minDate;
            this.datePicker.maxDate = this.maxDate;
            this.datePicker.type = this.type || 'day';
            this.datePicker.config = this.config;
            this.datePicker.init();
        }
    };
    return DatePickerDirective;
}());
DatePickerDirective.decorators = [
    { type: core_1.Directive, args: [{
                exportAs: 'dpDayPicker',
                providers: [date_picker_directive_service_1.DatePickerDirectiveService],
                selector: '[dpDayPicker]',
            },] },
];
/** @nocollapse */
DatePickerDirective.ctorParameters = function () { return [
    { type: core_1.ViewContainerRef, },
    { type: core_1.ComponentFactoryResolver, },
    { type: forms_1.NgControl, decorators: [{ type: core_1.Optional },] },
    { type: date_picker_directive_service_1.DatePickerDirectiveService, },
]; };
DatePickerDirective.propDecorators = {
    'config': [{ type: core_1.Input, args: ['dpDayPicker',] },],
    'attachTo': [{ type: core_1.Input },],
    'theme': [{ type: core_1.Input },],
    'type': [{ type: core_1.Input },],
    'minDate': [{ type: core_1.Input },],
    'maxDate': [{ type: core_1.Input },],
    'onClick': [{ type: core_1.HostListener, args: ['click',] },],
    'onFocus': [{ type: core_1.HostListener, args: ['focus',] },],
};
exports.DatePickerDirective = DatePickerDirective;
//# sourceMappingURL=date-picker.directive.js.map